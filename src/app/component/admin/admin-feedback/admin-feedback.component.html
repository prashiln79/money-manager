<div class="admin-feedback-container">
  <!-- Header -->
  <div class="section-header">
    <div class="header-content">
      <h2>User Feedback Management</h2>
      <p>View, filter, and manage user feedback submissions</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="accent" (click)="exportFeedback()" [disabled]="filteredFeedback.length === 0">
        <mat-icon>download</mat-icon>
        Export CSV
      </button>
      <button mat-raised-button color="warn" (click)="clearFilters()">
        <mat-icon>clear</mat-icon>
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-bar">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Search feedback</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Search by name, email, subject, or message">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <div class="filter-controls">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Status</mat-label>
        <mat-select [formControl]="statusFilter">
          <mat-option *ngFor="let option of statusOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Category</mat-label>
        <mat-select [formControl]="categoryFilter">
          <mat-option *ngFor="let option of categoryOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Priority</mat-label>
        <mat-select [formControl]="priorityFilter">
          <mat-option *ngFor="let option of priorityOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Date Range</mat-label>
        <mat-select [formControl]="dateRangeFilter">
          <mat-option *ngFor="let option of dateRangeOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <div class="summary-info">
      <span class="total-count">Showing {{ filteredFeedback.length }} of {{ feedbackList.length }} feedback items</span>
      <span class="page-info" *ngIf="totalItems > 0">
        Page {{ currentPage }} of {{ getTotalPages() }}
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading feedback...</p>
  </div>

  <!-- Feedback List -->
  <div *ngIf="!isLoading && getPaginatedFeedback().length > 0" class="feedback-list">
    <div *ngFor="let feedback of getPaginatedFeedback()" class="feedback-item">
      <div class="feedback-header">
        <div class="feedback-meta">
          <div class="user-info">
            <div class="avatar">
              <mat-icon>person</mat-icon>
            </div>
            <div class="user-details">
              <h4>{{ feedback.name }}</h4>
              <p>{{ feedback.email }}</p>
            </div>
          </div>
          <div class="feedback-badges">
            <span class="badge category" [style.background-color]="getStatusColor(feedback.status)">
              <mat-icon>{{ getCategoryIcon(feedback.category) }}</mat-icon>
              {{ feedback.category | titlecase }}
            </span>
            <span class="badge priority" [style.background-color]="getPriorityColor(feedback.priority)">
              {{ feedback.priority | titlecase }}
            </span>
            <span class="badge status" [style.background-color]="getStatusColor(feedback.status)">
              {{ feedback.status | titlecase }}
            </span>
            <span class="badge rating" *ngIf="feedback.rating">
              <mat-icon>star</mat-icon>
              {{ feedback.rating }}/5
            </span>
          </div>
        </div>
        <div class="feedback-actions">
          <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="Actions">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="updateFeedbackStatus(feedback, 'pending')" *ngIf="feedback.status !== 'pending'">
              <mat-icon>pending</mat-icon>
              Mark as Pending
            </button>
            <button mat-menu-item (click)="updateFeedbackStatus(feedback, 'reviewed')" *ngIf="feedback.status !== 'reviewed'">
              <mat-icon>visibility</mat-icon>
              Mark as Reviewed
            </button>
            <button mat-menu-item (click)="updateFeedbackStatus(feedback, 'resolved')" *ngIf="feedback.status !== 'resolved'">
              <mat-icon>check_circle</mat-icon>
              Mark as Resolved
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="deleteFeedback(feedback)" class="delete-action">
              <mat-icon>delete</mat-icon>
              Delete Feedback
            </button>
          </mat-menu>
        </div>
      </div>

      <div class="feedback-content">
        <div class="feedback-subject">
          <h3>{{ feedback.subject }}</h3>
          <span class="timestamp">{{ formatDate(feedback.timestamp) }}</span>
        </div>
        <div class="feedback-message">
          <p>{{ feedback.message }}</p>
        </div>
      </div>

      <div class="feedback-footer">
        <div class="technical-info">
          <span class="info-item">
            <mat-icon>computer</mat-icon>
            {{ feedback.userAgent?.substring(0, 50) }}...
          </span>
          <span class="info-item">
            <mat-icon>info</mat-icon>
            v{{ feedback.appVersion }}
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && getPaginatedFeedback().length === 0" class="empty-state">
    <mat-icon>feedback</mat-icon>
    <h3>No feedback found</h3>
    <p *ngIf="filteredFeedback.length === 0 && feedbackList.length > 0">
      No feedback matches your current filters. Try adjusting your search criteria.
    </p>
    <p *ngIf="feedbackList.length === 0">
      No feedback has been submitted yet.
    </p>
    <button *ngIf="filteredFeedback.length === 0 && feedbackList.length > 0" 
            mat-raised-button color="primary" 
            (click)="clearFilters()">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="getTotalPages() > 1" class="pagination-container">
    <mat-paginator
      [length]="totalItems"
      [pageSize]="itemsPerPage"
      [pageIndex]="currentPage - 1"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event.pageIndex + 1)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div> 