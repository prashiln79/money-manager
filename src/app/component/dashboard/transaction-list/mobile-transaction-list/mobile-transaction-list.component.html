<div class="mobile-transaction-container">
	<!-- Mobile Filter Header -->
	<div class="mobile-filter-header" *ngIf="showFilters">
		<!-- Active Filters Indicator -->
		<div *ngIf="hasActiveFilters()" class="active-filters-indicator flex justify-between items-center">
			<div class="filter-icon-container">
				<mat-icon class="filter-icon">filter_alt</mat-icon>
				<span class="filter-text">{{ getActiveFiltersCount() }} Filter{{ getActiveFiltersCount() > 1 ? 's' : '' }} Active</span>
			</div>
			<div class="">
				<mat-icon class="text-black relative top-1 !text-blue-700 text-sm" (click)="quickClearFilters()">clear</mat-icon>
			</div>
		</div>
		<!-- Search Bar -->
		<div class="search-container">
			<div class="search-input-wrapper">
				<mat-icon class="search-icon">search</mat-icon>
				<input type="text" [ngModel]="searchTerm" (ngModelChange)="onSearchChange($event)" placeholder="Search transactions..." class="search-input" />
				<button *ngIf="searchTerm" mat-icon-button class="clear-search-btn" (click)="onSearchChange('')">
					<mat-icon>close</mat-icon>
				</button>
			</div>
		</div>

		<!-- Filter Menu Buttons -->
		<div class="filter-menu-container">
			<!-- Import Button -->
			<button mat-icon-button class="filter-menu-btn import-btn" (click)="openImportDialog()" matTooltip="Import transactions">
				<mat-icon>upload_file</mat-icon>
			</button>

			<!-- Sort Menu -->
			<button mat-icon-button class="filter-menu-btn" [matMenuTriggerFor]="sortMenu" matTooltip="{{ getCurrentSortLabel() }}">
				<mat-icon>sort</mat-icon>
			</button>

			<mat-menu #sortMenu="matMenu" class="filter-menu">
				<button *ngFor="let option of sortOptions" mat-menu-item [class.active-menu-item]="selectedSort === option.value" (click)="onSortChange(option.value)">
					<mat-icon>{{ option.icon }}</mat-icon>
					<span>{{ option.label }}</span>
					<mat-icon *ngIf="selectedSort === option.value" class="check-icon">check</mat-icon>
				</button>
			</mat-menu>

			<!-- Type Menu -->
			<button mat-icon-button class="filter-menu-btn" [matMenuTriggerFor]="typeMenu" matTooltip="{{ getCurrentTypeLabel() }}">
				<mat-icon>account_balance_wallet</mat-icon>
			</button>

			<mat-menu #typeMenu="matMenu" class="filter-menu">
				<button mat-menu-item [class.active-menu-item]="selectedType === 'all'" (click)="onTypeChange('all')">
					<mat-icon>list</mat-icon>
					<span>All Types</span>
					<mat-icon *ngIf="selectedType === 'all'" class="check-icon">check</mat-icon>
				</button>
				<button mat-menu-item [class.active-menu-item]="selectedType === 'income'" (click)="onTypeChange('income')">
					<mat-icon class="income-icon">trending_up</mat-icon>
					<span>Income</span>
					<mat-icon *ngIf="selectedType === 'income'" class="check-icon">check</mat-icon>
				</button>
				<button mat-menu-item [class.active-menu-item]="selectedType === 'expense'" (click)="onTypeChange('expense')">
					<mat-icon class="expense-icon">trending_down</mat-icon>
					<span>Expense</span>
					<mat-icon *ngIf="selectedType === 'expense'" class="check-icon">check</mat-icon>
				</button>
			</mat-menu>

			<!-- Category Menu -->
			<button mat-icon-button class="filter-menu-btn" [matMenuTriggerFor]="categoryMenu" matTooltip="{{ getCurrentCategoryLabel() }}">
				<mat-icon>category</mat-icon>
			</button>

			<mat-menu #categoryMenu="matMenu" class="filter-menu">
				<button mat-menu-item [class.active-menu-item]="selectedCategory.includes('all')" (click)="onCategoryChange('all')">
					<mat-icon>list</mat-icon>
					<span>All Categories</span>
					<mat-icon *ngIf="selectedCategory.includes('all')" class="check-icon">check</mat-icon>
				</button>
				<mat-divider></mat-divider>
				<button *ngFor="let category of getCategoriesList()" mat-menu-item [class.active-menu-item]="isCategorySelected(category)" (click)="onCategoryChange(category)">
					<mat-icon>{{ getCategoryIcon(category) }}</mat-icon>
					<span>{{ category }}</span>
					<mat-icon *ngIf="isCategorySelected(category)" class="check-icon">check</mat-icon>
				</button>
			</mat-menu>

			<!-- Date Range Menu -->
			<button mat-icon-button class="filter-menu-btn" [matMenuTriggerFor]="dateMenu" matTooltip="{{ getCurrentDateLabel() }}">
				<mat-icon>calendar_today</mat-icon>
			</button>

			<mat-menu #dateMenu="matMenu" class="filter-menu">
				<button mat-menu-item [class.active-menu-item]="selectedDateRange === null" (click)="onDateRangeChange(null)">
					<mat-icon>all_inclusive</mat-icon>
					<span>All Time</span>
					<mat-icon *ngIf="selectedDateRange === null" class="check-icon">check</mat-icon>
				</button>
				<button mat-menu-item [class.active-menu-item]="isCurrentMonth()" (click)="onDateRangeChange('currentMonth')">
					<mat-icon>calendar_month</mat-icon>
					<span>This Month</span>
					<mat-icon *ngIf="isCurrentMonth()" class="check-icon">check</mat-icon>
				</button>
				<button mat-menu-item [class.active-menu-item]="isLastMonth()" (click)="onDateRangeChange('lastMonth')">
					<mat-icon>calendar_view_month</mat-icon>
					<span>Last Month</span>
					<mat-icon *ngIf="isLastMonth()" class="check-icon">check</mat-icon>
				</button>
				<button mat-menu-item [class.active-menu-item]="isCurrentYear()" (click)="onDateRangeChange('currentYear')">
					<mat-icon>calendar_today</mat-icon>
					<span>This Year</span>
					<mat-icon *ngIf="isCurrentYear()" class="check-icon">check</mat-icon>
				</button>
				<mat-divider></mat-divider>
				<button mat-menu-item [class.active-menu-item]="isCustomDateRange()" (click)="openCustomDateRangeDialog()">
					<mat-icon>date_range</mat-icon>
					<span>Custom Range</span>
					<mat-icon *ngIf="isCustomDateRange()" class="check-icon">check</mat-icon>
				</button>
			</mat-menu>
		</div>
	</div>

	<!-- Transaction Summary -->
	<div class="transaction-summary" *ngIf="showFilters && filteredTransactions.length > 0">
		<div class="summary-stats">
			<div class="stat-item">
				<span class="stat-value">{{ getFilteredCount() }}</span>
				<span class="stat-total">/ {{ getTotalCount() }}</span>
			</div>
			<div class="stat-item">
				<span class="stat-value income">+₹{{ getTotalIncome() | number:'1.0-0' }}</span>
			</div>
			<div class="stat-item">
				<span class="stat-value expense">-₹{{ getTotalExpenses() | number:'1.0-0' }}</span>
			</div>
		</div>
	</div>

	<!-- Transaction List -->
	<div class="transaction-list-container">
		<div class="transaction-scroll">
			<!-- Empty State -->
			<div *ngIf="!filteredTransactions.length" class="empty-state">
				<div class="empty-icon">
					<mat-icon>receipt_long</mat-icon>
				</div>
				<h3 class="empty-title text-base">No transactions found</h3>
				<p class="empty-description text-base">
					{{ transactions.length === 0 ? 'Start by adding your first transaction' : 'No transactions match your current filters. Try adjusting your search or filters.' }}
				</p>
				<button *ngIf="transactions.length === 0" mat-raised-button color="primary" class="add-first-btn" (click)="onAddTransaction()">
					<mat-icon>add</mat-icon>
					<span class="text-base">Add First Transaction</span>
				</button>
				<button *ngIf="transactions.length > 0 && hasActiveFilters()" mat-stroked-button class="clear-filters-btn-large" (click)="clearAllFilters()">
					<mat-icon>clear</mat-icon>
					<span class="text-base">Clear Filters</span>
				</button>
			</div>

			<!-- Transaction Cards -->
			@for (tx of filteredTransactions; track tx.id) {
			<div class="transaction-card" [class.selected]="selectedTx?.id === tx.id" (click)="onLongPress(tx)">
				<!-- Main Transaction Content -->
				<div class="transaction-main">
					<!-- Icon Section -->
					<div class="transaction-icon">
						<div class="icon-container">
							<mat-icon [style.color]="getCategoryColor(tx.category)">
								{{ getCategoryIcon(tx.category) }}
							</mat-icon>
						</div>
					</div>

					<!-- Transaction Details -->
					<div class="transaction-details">
						<div class="transaction-title text-base">
							{{ tx.payee | titlecase }}
						</div>
						<!-- <div class="transaction-category text-base">
              {{ tx.category }}
            </div> -->
						<div class="transaction-date text-base">
							{{ dateService.toDate(tx.date) | date:'dd MMM - hh:mm' }}
						</div>
						<div *ngIf="tx.notes" class="transaction-notes text-base">
							{{ tx.notes }}
						</div>
					</div>

					<!-- Amount Section -->
					<div class="transaction-amount">
						<div class="amount-value text-base" [ngClass]="tx.type === 'income' ? 'income-text' : 'expense-text'">
							{{ tx.type === 'income' ? '+' : '-' }}₹{{ tx.amount | number:'1.0-0' }}
						</div>
						<div class="amount-type text-base">
							{{ getCategoryName(tx.categoryId) }}
						</div>
					</div>
				</div>

				<!-- Action Buttons (shown when selected) -->
				<div *ngIf="selectedTx?.id === tx.id" class="transaction-actions">
					<div class="actions-container">
						<button mat-icon-button class="action-button edit-btn" (click)="onEditTransaction(tx)" matTooltip="Edit transaction">
							<mat-icon>edit</mat-icon>
						</button>
						<button mat-icon-button class="action-button delete-btn" (click)="onDeleteTransaction(tx)" matTooltip="Delete transaction">
							<mat-icon>delete</mat-icon>
						</button>
					</div>
				</div>

				<!-- Expanded Details (shown when selected) -->
				<div *ngIf="selectedTx?.id === tx.id" class="transaction-details-expanded">
					<div class="details-container">
						<!-- Account Information -->
						<div class="detail-row">
							<div class="detail-label">
								<mat-icon class="detail-icon">account_balance</mat-icon>
								<span>Account</span>
							</div>
							<div class="detail-value">
								<span class="account-name">{{ getAccountName(tx.accountId) }}</span>
								<span class="account-type" *ngIf="getAccountType(tx.accountId)">({{ getAccountType(tx.accountId) }})</span>
							</div>
						</div>

						<!-- Transaction ID -->
						<div class="detail-row" *ngIf="tx.id">
							<div class="detail-label">
								<mat-icon class="detail-icon">fingerprint</mat-icon>
								<span>Transaction ID</span>
							</div>
							<div class="detail-value">
								<span class="transaction-id">{{ tx.id }}</span>
							</div>
						</div>

						<!-- Recurring Status -->
						<div class="detail-row" *ngIf="tx.isRecurring">
							<div class="detail-label">
								<mat-icon class="detail-icon">repeat</mat-icon>
								<span>Recurring</span>
							</div>
							<div class="detail-value">
								<span class="recurring-info">{{ getRecurringInfo(tx) }}</span>
							</div>
						</div>

						<!-- Sync Status -->
						<div class="detail-row">
							<div class="detail-label">
								<mat-icon class="detail-icon" [style.color]="getSyncStatusColor(tx)">{{ getSyncStatusIcon(tx) }}</mat-icon>
								<span>Status</span>
							</div>
							<div class="detail-value">
								<span class="sync-status" [style.color]="getSyncStatusColor(tx)">{{ getSyncStatusInfo(tx) }}</span>
							</div>
						</div>

						<!-- Created Date -->
						<div class="detail-row">
							<div class="detail-label">
								<mat-icon class="detail-icon">schedule</mat-icon>
								<span>Created Date</span>
							</div>
							<div class="detail-value">
								<span class="created-date">{{ dateService.toDate(tx.date) | date:'fullDate' }}</span>
							</div>
						</div>

						<!-- Created Time -->
						<div class="detail-row">
							<div class="detail-label">
								<mat-icon class="detail-icon">schedule</mat-icon>
								<span>Created Time</span>
							</div>
							<div class="detail-value">
								<span class="created-time">{{ dateService.toDate(tx.date) | date:'shortTime' }}</span>
							</div>
						</div>

						<!-- Notes (if available) -->
						<div class="detail-row" *ngIf="tx.notes && tx.notes.trim()">
							<div class="detail-label">
								<mat-icon class="detail-icon">note</mat-icon>
								<span>Notes</span>
							</div>
							<div class="detail-value">
								<span class="transaction-notes">{{ tx.notes }}</span>
							</div>
						</div>

						<!-- Payment Method -->
						<div class="detail-row" *ngIf="tx.paymentMethod">
							<div class="detail-label">
								<mat-icon class="detail-icon">payment</mat-icon>
								<span>Payment Method</span>
							</div>
							<div class="detail-value">
								<span class="payment-method">{{ tx.paymentMethod }}</span>
							</div>
						</div>

						<!-- Tax Amount -->
						<div class="detail-row" *ngIf="tx.taxAmount">
							<div class="detail-label">
								<mat-icon class="detail-icon">payment</mat-icon>
								<span>Tax Amount</span>
							</div>
							<div class="detail-value"></div>
							<span class="tax-amount">{{ tx.taxAmount | number:'1.0-0' }}</span>
						</div>
					</div>

					<!-- Tax Percentage -->
					<div class="detail-row" *ngIf="tx.taxPercentage">
						<div class="detail-label">
							<mat-icon class="detail-icon">payment</mat-icon>
							<span>Tax Percentage</span>
						</div>
						<div class="detail-value">
							<span class="tax-percentage">{{ tx.taxPercentage }}%</span>
						</div>
					</div>
				</div>
			</div>
			}
		</div>
	</div>
</div>
