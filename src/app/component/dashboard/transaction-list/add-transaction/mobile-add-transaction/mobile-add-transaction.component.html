<!-- Mobile Header -->
<div class="sticky top-0 z-20 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
	<div class="flex items-center justify-between px-4 py-3">
		<h6 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
			{{ dialogData?.id ? 'Edit' : 'Add' }} Transaction
		</h6>
		<div class="flex items-center gap-2">
			<!-- Add Button -->
			<button 
				mat-icon-button 
				color="primary" 
				(click)="onSubmit()" 
				[disabled]="transactionForm.invalid || isSubmitting" 
				matTooltip="Save Transaction" 
				class="w-10 h-10 !bg-primary"
			>
				<mat-icon class="text-white">
					{{ isSubmitting ? 'hourglass_empty' : 'check' }}
				</mat-icon>
			</button>

			<!-- Close Button -->
			<button 
				mat-icon-button 
				type="button" 
				(click)="onClose()" 
				matTooltip="Close" 
				class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
			>
				<mat-icon>close</mat-icon>
			</button>
		</div>
	</div>
</div>

<!-- Mobile Form Content -->
<div class="flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900">
	<div class="p-4 space-y-6">
		<form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" (keydown.enter)="onSubmit()" class="space-y-6">
			
			<!-- Amount, Description, Category, and Date Field - Combined Card -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm space-y-4">
				<!-- Amount Field -->
				<div>
					<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Amount *
					</label>
					<input 
						#amountInput
						type="number" 
						formControlName="amount" 
						placeholder="0.00" 
						step="0.01" 
						min="0" 
						class="w-full text-2xl font-bold text-center py-3 px-4 border-0 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
					/>
					@if(getAmountError() && transactionForm.get('amount')?.touched) {
						<p class="text-red-500 text-sm mt-1">{{ getAmountError() }}</p>
					}
				</div>

				<!-- Description Field -->
				<div>
					<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Description *
					</label>
					<input 
						type="text" 
						formControlName="payee" 
						[maxlength]="45" 
						placeholder="Enter description" 
						class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
					/>
					<div class="flex justify-between items-center mt-1">
						@if(transactionForm.get('payee')?.hasError('required') && transactionForm.get('payee')?.touched) {
							<p class="text-red-500 text-sm">Description is required</p>
						}
						<span class="text-xs text-gray-500">
							{{ transactionForm.get('payee')?.value?.length || 0 }}/45
						</span>
					</div>
				</div>

				<!-- Category Field -->
				<div>
					<div class="flex items-center justify-between mb-2">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
							Category
						</label>
						<button 
							type="button"
							(click)="openNewCategoryDialog()"
							class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium flex items-center gap-1"
						>
							<mat-icon class="text-sm">add</mat-icon>Add
						</button>
					</div>
					<select 
						formControlName="tag"  (change)="onCategoryChange($event)"
						class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
					>
						@for (item of tagList; track item) {
							<option [value]="item.name">{{ item?.name }}</option>
						}
					</select>
				</div>

				<!-- Date Field -->
				<div>
					<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
						Date *
					</label>
					<div class="relative">
						<input 
							type="date" 
							formControlName="date" 
							class="w-full py-3 px-4 pr-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent [&::-webkit-calendar-picker-indicator]:bg-none [&::-webkit-calendar-picker-indicator]:bg-transparent [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:right-0 [&::-webkit-calendar-picker-indicator]:top-0 [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:h-full [&::-webkit-calendar-picker-indicator]:cursor-pointer"
						/>
						<mat-icon class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
							calendar_today
						</mat-icon>
					</div>
					@if(getDateError()) {
						<p class="text-red-500 text-sm mt-1">{{ getDateError() }}</p>
					}
				</div>
			</div>

			<!-- Account Field -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
				<div class="flex items-center justify-between mb-2">
					<label class="block text-sm font-medium text-gray-700 dark:text-gray-300">
						Account *
					</label>
					<!-- @if(transactionForm.get('accountId')?.value) {
						@for (account of accountList; track account.accountId) {
							@if(account.accountId === transactionForm.get('accountId')?.value) {
								<button 
									matSuffix 
									mat-icon-button 
									type="button"
									(click)="openEditAccountDialog(account)"
									matTooltip="Edit {{ account.name }}"
									class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
								>
									<mat-icon class="text-sm">edit</mat-icon>
								</button>
							}
						}
					} -->
					<button 
						type="button"
						(click)="openNewAccountDialog()"
						class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium flex items-center gap-1"
					>
						<mat-icon class="text-sm">add</mat-icon>
						Add
					</button>
					
				</div>
				
				<div class="space-y-2">
					<mat-form-field appearance="fill" class="w-full">
						<mat-label>Select an account</mat-label>
						<mat-select formControlName="accountId">
							@for (account of accountList; track account.accountId) {
								<mat-option [value]="account.accountId">{{ account.name }} ({{ account.type | titlecase }})</mat-option>
							}
						</mat-select>
						
						@if(transactionForm.get('accountId')?.hasError('required') && transactionForm.get('accountId')?.touched) {
							<mat-error>Account is required</mat-error>
						}
					</mat-form-field>
					
				</div>
			</div>





			<!-- Notes Field -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
					Notes
				</label>
				<textarea 
					formControlName="description" 
					[rows]="3" 
					placeholder="Add any additional notes..." 
					class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
				></textarea>
			</div>

			<!-- Bottom Spacing for Mobile -->
			<div class="h-20"></div>
		</form>
	</div>
</div> 