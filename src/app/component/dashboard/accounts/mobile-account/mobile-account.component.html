<!-- Mobile Header -->
<div class="sticky top-0 z-20 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
	<div class="flex items-center justify-between px-4 py-3">
		<h6 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
			{{ dialogData?.accountId ? 'Edit' : 'Add' }} Account
		</h6>
		<div class="flex items-center gap-2">
			<!-- Add Button -->
			<button 
				mat-icon-button 
				color="primary" 
				(click)="onSubmit()" 
				[disabled]="accountForm.invalid || isSubmitting" 
				matTooltip="Save Account" 
				class="w-10 h-10 !bg-primary"
			>
				<mat-icon class="text-white">
					{{ isSubmitting ? 'hourglass_empty' : 'check' }}
				</mat-icon>
			</button>

			<!-- Close Button -->
			<button 
				mat-icon-button 
				type="button" 
				(click)="onClose()" 
				matTooltip="Close" 
				class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
			>
				<mat-icon>close</mat-icon>
			</button>
		</div>
	</div>
</div>

<!-- Mobile Form Content -->
<div class="flex-1 overflow-y-auto bg-gray-50 dark:bg-gray-900">
	<div class="p-4 space-y-6">
		<form [formGroup]="accountForm" (ngSubmit)="onSubmit()" class="space-y-6">
			
			<!-- Account Name Field -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
					Account Name *
				</label>
				<input 
					type="text" 
					formControlName="name" 
					[maxlength]="50" 
					placeholder="e.g., Chase Checking" 
					autofocus
					class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
				/>
				<div class="flex justify-between items-center mt-1">
					@if(getNameError() && accountForm.get('name')?.touched) {
						<p class="text-red-500 text-sm">{{ getNameError() }}</p>
					}
					<span class="text-xs text-gray-500">
						{{ accountForm.get('name')?.value?.length || 0 }}/50
					</span>
				</div>
			</div>

			<!-- Account Type Field -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
					Account Type *
				</label>
				<select 
					formControlName="type" 
					class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
				>
					@for (type of accountTypes; track type.value) {
						<option [value]="type.value">{{ type.label }}</option>
					}
				</select>
				@if(accountForm.get('type')?.hasError('required') && accountForm.get('type')?.touched) {
					<p class="text-red-500 text-sm mt-1">Account type is required</p>
				}
			</div>

			<!-- Balance Field -->
			<div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
					Initial Balance *
				</label>
				<input 
					type="number" 
					formControlName="balance" 
					placeholder="0.00" 
					step="0.01" 
					class="w-full text-2xl font-bold text-center py-3 px-4 border-0 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500 rounded-lg"
				/>
				@if(getBalanceError() && accountForm.get('balance')?.touched) {
					<p class="text-red-500 text-sm mt-1">{{ getBalanceError() }}</p>
				}
			</div>

			<!-- Loan-specific fields (only shown when type is 'loan') -->
			@if(isLoanAccount()) {
				<!-- Loan Details Section -->
				<div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4">
					<h4 class="text-sm font-semibold text-amber-800 dark:text-amber-200 mb-4 flex items-center gap-2">
						<mat-icon class="text-amber-600 dark:text-amber-400">account_balance_wallet</mat-icon>
						Loan Details
					</h4>

					<!-- Lender Name -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Lender Name *
						</label>
						<input 
							type="text" 
							formControlName="lenderName" 
							placeholder="e.g., Bank of America" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
						@if(accountForm.get('lenderName')?.hasError('required') && accountForm.get('lenderName')?.touched) {
							<p class="text-red-500 text-sm mt-1">Lender name is required</p>
						}
					</div>

					<!-- Loan Amount -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Loan Amount *
						</label>
						<input 
							type="number" 
							formControlName="loanAmount" 
							placeholder="0.00" 
							step="0.01" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
						@if(getLoanAmountError() && accountForm.get('loanAmount')?.touched) {
							<p class="text-red-500 text-sm mt-1">{{ getLoanAmountError() }}</p>
						}
					</div>

					<!-- Interest Rate -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Annual Interest Rate (%) *
						</label>
						<input 
							type="number" 
							formControlName="interestRate" 
							placeholder="5.5" 
							step="0.1" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
						@if(getInterestRateError() && accountForm.get('interestRate')?.touched) {
							<p class="text-red-500 text-sm mt-1">{{ getInterestRateError() }}</p>
						}
					</div>

					<!-- Start Date -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Loan Start Date *
						</label>
						<input 
							type="date" 
							formControlName="startDate" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
					</div>

					<!-- Duration -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Loan Duration (months) *
						</label>
						<input 
							type="number" 
							formControlName="durationMonths" 
							placeholder="12" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
						@if(getDurationError() && accountForm.get('durationMonths')?.touched) {
							<p class="text-red-500 text-sm mt-1">{{ getDurationError() }}</p>
						}
					</div>

					<!-- Repayment Frequency -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Repayment Frequency *
						</label>
						<select 
							formControlName="repaymentFrequency" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						>
							@for (freq of repaymentFrequencies; track freq.value) {
								<option [value]="freq.value">{{ freq.label }}</option>
							}
						</select>
					</div>

					<!-- Loan Status -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Loan Status *
						</label>
						<select 
							formControlName="status" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						>
							@for (status of loanStatuses; track status.value) {
								<option [value]="status.value">{{ status.label }}</option>
							}
						</select>
					</div>

					<!-- Total Paid -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Total Amount Paid
						</label>
						<input 
							type="number" 
							formControlName="totalPaid" 
							placeholder="0.00" 
							step="0.01" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
					</div>

					<!-- Remaining Balance (read-only) -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Remaining Balance
						</label>
						<input 
							type="number" 
							formControlName="remainingBalance" 
							readonly
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400"
						/>
					</div>

					<!-- Next Due Date -->
					<div class="mb-4">
						<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
							Next Payment Due Date *
						</label>
						<input 
							type="date" 
							formControlName="nextDueDate" 
							class="w-full py-3 px-4 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent focus:outline-none focus:ring-2 focus:ring-amber-500 focus:border-transparent"
						/>
					</div>

					<!-- Show Reminder -->
					<div class="mb-4">
						<label class="flex items-center gap-2">
							<input 
								type="checkbox" 
								formControlName="showReminder"
								class="w-4 h-4 text-amber-600 bg-gray-100 border-gray-300 rounded focus:ring-amber-500 dark:focus:ring-amber-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"
							/>
							<span class="text-sm font-medium text-gray-700 dark:text-gray-300">
								Show payment reminders
							</span>
						</label>
					</div>
				</div>
			}

			<!-- Bottom Spacing for Mobile -->
			<div class="h-20"></div>
		</form>
	</div>
</div> 