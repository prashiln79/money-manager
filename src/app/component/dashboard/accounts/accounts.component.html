<div class="accounts-container">
	<!-- Error Message Display -->
	<div *ngIf="errorMessage" class="error-message mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center justify-between">
		<p class="text-red-700 text-sm">{{ errorMessage }}</p>
		<button (click)="clearError()" class="text-red-500 hover:text-red-700 text-lg font-bold">
			Ã—
		</button>
	</div>

	<!-- Loading Indicator -->
	<!-- <div *ngIf="isLoading$ | async" class="loading-indicator flex justify-center items-center py-12">
		<mat-spinner diameter="32"></mat-spinner>
	</div> -->

	<!-- Main Content -->
	<div  class="accounts-main">
		<!-- Header -->
		<div class="accounts-header">
			<div class="header-content">
				<h4 class="header-title">Your Accounts</h4>
				<p class="header-subtitle">({{ (accounts$ | async)?.length || 0 }} account{{ ((accounts$ | async)?.length || 0) !== 1 ? 's' : '' }})</p>
			</div>
			<button mat-fab color="primary" (click)="addAccount()" class="add-account-btn">
				<mat-icon>add</mat-icon>
			</button>
		</div>

		<!-- Empty State -->
		<div *ngIf="(accounts$ | async)?.length === 0" class="empty-state">
			<div class="empty-icon">ðŸ’³</div>
			<h3 class="empty-title">No accounts yet</h3>
			<p class="empty-text">Add your first account to get started</p>
			<button mat-raised-button 
					color="primary" 
					(click)="addAccount()"
					class="empty-action">
				<mat-icon>add</mat-icon>
				Add Account
			</button>
		</div>

		<!-- Accounts List -->
		<div *ngIf="(accounts$ | async) as accounts" class="accounts-list">
			<ng-container *ngIf="accounts$ | async as accounts">
				<div
					*ngFor="let account of accounts; trackBy: trackByAccountId"
					class="account-item"
					[class]="getBalanceClass(account)"
					[class.expanded]="expandedAccount?.accountId === account.accountId"
				>
					<div class="account-content">
						<div class="account-info">
							<div class="account-icon">
								<mat-icon>{{ getAccountIcon(account.type) }}</mat-icon>
							</div>
							<div class="account-details">
								<h3 class="account-name">{{ account.name }}</h3>
								
								@if(isLoanAccount(account)){
									<p class="account-type"><b>Interest Rate:</b> {{ getLoanDetails(account)?.interestRate +'%'  }}</p>
								}@else{
									<p class="account-type">{{ account.type  | titlecase }}</p>
								}
							</div>
						</div>
						
						<div class="account-balance" >
							<span class="balance-amount">{{ account.balance | currency }}</span>
						</div>

						<div class="account-menu">
							<button mat-icon-button [matMenuTriggerFor]="accountMenu" matTooltip="More options" class="menu-btn">
								<mat-icon>more_vert</mat-icon>
							</button>
							<mat-menu #accountMenu="matMenu">
								<button mat-menu-item (click)="editAccount(account)">
									<mat-icon>edit</mat-icon>
									<span>Edit Account</span>
								</button>
								<button mat-menu-item (click)="deleteAccount(account)" class="delete-menu-item">
									<mat-icon>delete</mat-icon>
									<span>Delete Account</span>
								</button>
							</mat-menu>
						</div>
					</div>

					<!-- Expand/Collapse Button -->
					<div class="expand-section">
						<button mat-button (click)="toggleAccountExpansion(account)" class="expand-btn">
							<mat-icon>{{ expandedAccount?.accountId === account.accountId ? 'expand_less' : 'expand_more' }}</mat-icon>
							<span>{{ expandedAccount?.accountId === account.accountId ? 'Show Less' : 'Show More' }}</span>
						</button>
					</div>

					<!-- Expanded Details -->
					<div *ngIf="expandedAccount?.accountId === account.accountId" class="account-details-expanded">
						<mat-tab-group class="details-tabs">
							<!-- Basic Details Tab -->
							<mat-tab label="Basic Details">
								<div class="tab-content">
									<div class="detail-row">
										<span class="detail-label">Account Name:</span>
										<span class="detail-value">{{ account.name }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Account Type:</span>
										<span class="detail-value">{{ account.type | titlecase }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Current Balance:</span>
										<span class="detail-value" [class]="account.balance >= 0 ? 'positive' : 'negative'">
											{{ account.balance | currency }}
										</span>
									</div>
									<div class="detail-row" *ngIf="account.description">
										<span class="detail-label">Description:</span>
										<span class="detail-value">{{ account.description }}</span>
									</div>
								</div>
							</mat-tab>

							<!-- Loan Details Tab (only for loan accounts) -->
							<mat-tab label="Loan Details" *ngIf="isLoanAccount(account)">
								<div class="tab-content">
									<div class="detail-row">
										<span class="detail-label">Lender Name:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.lenderName || 'N/A' }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Interest Rate:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.interestRate }}%</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Monthly Interest:</span>
										<span class="detail-value interest-amount">{{ calculateMonthlyInterest(account) | currency }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Next Due Date:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.nextDueDate | date:'fullDate' }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Remaining Balance:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.remainingBalance | currency }}</span>
									</div>
									<div class="detail-row">
										<span class="detail-label">Monthly Payment:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.monthlyPayment | currency }}</span>
									</div>
									<div class="detail-row" *ngIf="getLoanDetails(account)?.durationMonths">
										<span class="detail-label">Loan Term:</span>
										<span class="detail-value">{{ getLoanDetails(account)?.durationMonths }} months</span>
									</div>
								</div>
							</mat-tab>

							<!-- Transaction History Tab -->
							<mat-tab label="Recent Transactions">
								<div class="tab-content">
									<div class="no-transactions" *ngIf="!getRecentTransactions(account)?.length">
										<mat-icon>receipt_long</mat-icon>
										<p>No recent transactions</p>
									</div>
									<div class="transaction-list" *ngIf="getRecentTransactions(account)?.length">
										<div class="transaction-item" *ngFor="let transaction of getRecentTransactions(account)">
											<div class="transaction-info">
												<span class="transaction-description">{{ transaction.description }}</span>
												<span class="transaction-date">{{ transaction.date | date:'shortDate' }}</span>
											</div>
											<span class="transaction-amount" [class]="transaction.amount >= 0 ? 'positive' : 'negative'">
												{{ transaction.amount | currency }}
											</span>
										</div>
									</div>
								</div>
							</mat-tab>
						</mat-tab-group>
					</div>
				</div>
			</ng-container>
		</div>
	</div>
</div>
