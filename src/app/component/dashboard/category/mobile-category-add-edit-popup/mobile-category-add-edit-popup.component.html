<!-- Mobile Header -->
<div class="mobile-header">
  <div class="header-content">
    <div class="header-left">
      <button 
        mat-icon-button 
        type="button" 
        (click)="onCancel()" 
        matTooltip="Close" 
        class="close-button mobile-only"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h6 class="header-title">
        {{ dialogData?.id ? 'Edit' : 'Add' }} Category
      </h6>
    </div>
    
    <!-- Desktop Close Button -->
    <button 
      mat-icon-button 
      type="button" 
      (click)="onCancel()" 
      matTooltip="Close" 
      class="close-button desktop-only"
    >
      <mat-icon>close</mat-icon>
    </button>
    
    <!-- Save Button -->
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()" 
      [disabled]="categoryForm.invalid || isSubmitting" 
      matTooltip="Save Category" 
      class="save-button"
    >
      <mat-spinner *ngIf="isSubmitting" diameter="16"></mat-spinner>
      <mat-icon *ngIf="!isSubmitting">check</mat-icon>
      {{ isSubmitting ? 'Saving...' : 'Save' }}
    </button>
  </div>
</div>

<!-- Mobile Form Content -->
<div class="mobile-content">
  <div class="form-container">
    <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="category-form">
      
      <!-- Category Name Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">label</mat-icon>
          Category Name *
        </label>
        <input 
          type="text" 
          formControlName="name" 
          placeholder="e.g., Groceries"
          autofocus
          class="form-input"
        />
        <div class="field-footer">
          @if(getNameError() && categoryForm.get('name')?.touched) {
            <p class="error-message">{{ getNameError() }}</p>
          }
          <span class="character-count">
            {{ categoryForm.get('name')?.value?.length || 0 }}/50
          </span>
        </div>
      </div>

      <!-- Category Type Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">category</mat-icon>
          Category Type *
        </label>
        <div class="type-selector">
          <button 
            type="button"
            (click)="selectType('expense')"
            class="type-option"
            [class.selected]="categoryForm.get('type')?.value === 'expense'"
          >
            <mat-icon>trending_down</mat-icon>
            <span>Expense</span>
          </button>
          <button 
            type="button"
            (click)="selectType('income')"
            class="type-option"
            [class.selected]="categoryForm.get('type')?.value === 'income'"
          >
            <mat-icon>trending_up</mat-icon>
            <span>Income</span>
          </button>
        </div>
        @if(getTypeError() && categoryForm.get('type')?.touched) {
          <p class="error-message">{{ getTypeError() }}</p>
        }
      </div>

      <!-- Category Icon Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">emoji_emotions</mat-icon>
          Category Icon *
        </label>
        <div class="icon-selector">
          <button type="button"
                  (click)="openIconSelectorDialog()"
                  class="icon-preview-button"
                  [class.active]="categoryForm.get('icon')?.value">
            <div class="icon-preview">
              <mat-icon class="selected-icon">{{ categoryForm.get('icon')?.value || 'category' }}</mat-icon>
              <span class="icon-name">{{ categoryForm.get('icon')?.value || 'category' }}</span>
            </div>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>
          
      
        </div>
      </div>

      <!-- Category Color Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">palette</mat-icon>
          Category Color *
        </label>
        <div class="color-selector">
          <button type="button"
                  (click)="openColorSelectorDialog()"
                  class="color-preview-button"
                  [class.active]="categoryForm.get('color')?.value">
            <div class="color-preview">
              <div class="color-swatch" [style.background-color]="categoryForm.get('color')?.value || '#005cbb'"></div>
              <span class="color-name">{{ categoryForm.get('color')?.value || '#005cbb' }}</span>
            </div>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>
        </div>
      </div>

      <!-- Budget Section Toggle -->
      <div class="form-field">
        <div class="budget-toggle-section">
          <button type="button"
                  (click)="toggleBudgetSection()"
                  class="budget-toggle-button"
                  [class.active]="showBudgetSection">
            <mat-icon class="toggle-icon">{{ showBudgetSection ? 'expand_less' : 'expand_more' }}</mat-icon>
            <span class="toggle-text">Set Budget (Optional)</span>
            <mat-icon class="budget-icon">account_balance_wallet</mat-icon>
          </button>
        </div>
      </div>

      <!-- Budget Section -->
      <div class="budget-section" *ngIf="showBudgetSection">
        <form [formGroup]="budgetForm" class="budget-form">
          
          <!-- Enable Budget Toggle -->
          <div class="form-field">
            <div class="budget-enable-toggle">
              <mat-slide-toggle 
                formControlName="hasBudget" 
                color="primary"
                class="budget-toggle">
                <span class="toggle-label">Set budget for this category</span>
              </mat-slide-toggle>
            </div>
          </div>

          <!-- Budget Amount -->
          <div class="form-field" *ngIf="budgetForm.get('hasBudget')?.value">
            <label class="field-label">
              <mat-icon class="field-icon">attach_money</mat-icon>
              Budget Amount *
            </label>
            <input 
              type="number"
              formControlName="budgetAmount"
              placeholder="0.00"
              step="0.01"
              class="form-input"
            />
            @if(getBudgetAmountError() && budgetForm.get('budgetAmount')?.touched) {
              <p class="error-message">{{ getBudgetAmountError() }}</p>
            }
          </div>

          <!-- Budget Period -->
          <div class="form-field" *ngIf="budgetForm.get('hasBudget')?.value">
            <label class="field-label">
              <mat-icon class="field-icon">schedule</mat-icon>
              Budget Period *
            </label>
            <select formControlName="budgetPeriod" class="form-select">
              <option *ngFor="let period of budgetPeriods" [value]="period.value">
                {{ period.label }}
              </option>
            </select>
            @if(getBudgetPeriodError() && budgetForm.get('budgetPeriod')?.touched) {
              <p class="error-message">{{ getBudgetPeriodError() }}</p>
            }
          </div>

          <!-- Alert Threshold -->
          <div class="form-field" *ngIf="budgetForm.get('hasBudget')?.value">
            <label class="field-label">
              <mat-icon class="field-icon">notifications</mat-icon>
              Alert Threshold (%)
            </label>
            <input 
              type="number"
              formControlName="budgetAlertThreshold"
              placeholder="80"
              class="form-input"
            />
            <div class="field-hint">Get notified when you reach this percentage of your budget</div>
            @if(getBudgetThresholdError() && budgetForm.get('budgetAlertThreshold')?.touched) {
              <p class="error-message">{{ getBudgetThresholdError() }}</p>
            }
          </div>

          <!-- Enable Alerts -->
          <div class="form-field" *ngIf="budgetForm.get('hasBudget')?.value">
            <div class="alert-toggle-section">
              <mat-slide-toggle 
                formControlName="budgetAlertEnabled" 
                color="primary"
                class="alert-toggle">
                <span class="toggle-label">Enable budget alerts</span>
              </mat-slide-toggle>
            </div>
          </div>
        </form>
      </div>

      <!-- Bottom Spacing for Mobile -->
      <div class="bottom-spacing"></div>
    </form>
  </div>
</div> 