<!-- Mobile Header -->
<div class="mobile-header">
  <div class="header-content">
    <div class="header-left">
      <button 
        mat-icon-button 
        type="button" 
        (click)="onCancel()" 
        matTooltip="Close" 
        class="close-button"
      >
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h6 class="header-title">
        {{ dialogData?.id ? 'Edit' : 'Add' }} Category
      </h6>
    </div>
    
    <!-- Save Button -->
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()" 
      [disabled]="categoryForm.invalid || isSubmitting" 
      matTooltip="Save Category" 
      class="save-button"
    >
      <mat-spinner *ngIf="isSubmitting" diameter="16"></mat-spinner>
      <mat-icon *ngIf="!isSubmitting">check</mat-icon>
      {{ isSubmitting ? 'Saving...' : 'Save' }}
    </button>
  </div>
</div>

<!-- Mobile Form Content -->
<div class="mobile-content">
  <div class="form-container">
    <form [formGroup]="categoryForm" (ngSubmit)="onSubmit()" class="category-form">
      
      <!-- Category Name Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">label</mat-icon>
          Category Name *
        </label>
        <input 
          type="text" 
          formControlName="name" 
          placeholder="e.g., Groceries"
          maxlength="50"
          autofocus
          class="form-input"
        />
        <div class="field-footer">
          @if(getNameError() && categoryForm.get('name')?.touched) {
            <p class="error-message">{{ getNameError() }}</p>
          }
          <span class="character-count">
            {{ categoryForm.get('name')?.value?.length || 0 }}/50
          </span>
        </div>
      </div>

      <!-- Category Type Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">category</mat-icon>
          Category Type *
        </label>
        <div class="type-selector">
          <button 
            type="button"
            (click)="selectType('expense')"
            class="type-option"
            [class.selected]="categoryForm.get('type')?.value === 'expense'"
          >
            <mat-icon>trending_down</mat-icon>
            <span>Expense</span>
          </button>
          <button 
            type="button"
            (click)="selectType('income')"
            class="type-option"
            [class.selected]="categoryForm.get('type')?.value === 'income'"
          >
            <mat-icon>trending_up</mat-icon>
            <span>Income</span>
          </button>
        </div>
        @if(getTypeError() && categoryForm.get('type')?.touched) {
          <p class="error-message">{{ getTypeError() }}</p>
        }
      </div>

      <!-- Category Icon Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">emoji_emotions</mat-icon>
          Category Icon *
        </label>
        <div class="icon-selector">
          <button type="button"
                  (click)="toggleIconPicker()"
                  class="icon-preview-button"
                  [class.active]="showIconPicker">
            <div class="icon-preview">
              <mat-icon class="selected-icon">{{ categoryForm.get('icon')?.value || 'category' }}</mat-icon>
              <span class="icon-name">{{ categoryForm.get('icon')?.value || 'category' }}</span>
            </div>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>
          
          <!-- Icon Picker Dropdown -->
          <div *ngIf="showIconPicker" 
               class="icon-picker-dropdown"
               (clickOutside)="closeIconPicker()">
            <div class="icon-picker-header">
              <h6>Select Icon</h6>
              <button mat-icon-button (click)="closeIconPicker()" class="close-picker">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="icon-grid">
              <button *ngFor="let icon of availableIcons"
                      type="button"
                      (click)="selectIcon(icon)"
                      class="icon-option"
                      [class.selected]="categoryForm.get('icon')?.value === icon"
                      matTooltip="{{ icon }}">
                <mat-icon>{{ icon }}</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Category Color Field -->
      <div class="form-field">
        <label class="field-label">
          <mat-icon class="field-icon">palette</mat-icon>
          Category Color *
        </label>
        <div class="color-selector">
          <button type="button"
                  (click)="toggleColorPicker()"
                  class="color-preview-button"
                  [class.active]="showColorPicker">
            <div class="color-preview">
              <div class="color-swatch" [style.background-color]="categoryForm.get('color')?.value || '#2196F3'"></div>
              <span class="color-name">{{ categoryForm.get('color')?.value || '#2196F3' }}</span>
            </div>
            <mat-icon class="dropdown-icon">expand_more</mat-icon>
          </button>
          
          <!-- Color Picker Dropdown -->
          <div *ngIf="showColorPicker" 
               class="color-picker-dropdown"
               (clickOutside)="closeColorPicker()">
            <div class="color-picker-header">
              <h6>Select Color</h6>
              <button mat-icon-button (click)="closeColorPicker()" class="close-picker">
                <mat-icon>close</mat-icon>
              </button>
            </div>
            <div class="color-grid">
              <button *ngFor="let color of availableColors"
                      type="button"
                      (click)="selectColor(color)"
                      class="color-option"
                      [class.selected]="categoryForm.get('color')?.value === color"
                      [style.background-color]="color"
                      matTooltip="{{ color }}">
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom Spacing for Mobile -->
      <div class="bottom-spacing"></div>
    </form>
  </div>
</div> 