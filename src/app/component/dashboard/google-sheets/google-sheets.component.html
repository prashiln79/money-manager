<div class="google-sheets-container p-6 max-w-6xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-start gap-3 mb-3">
      <div class="w-10 h-10 bg-gradient-to-br mt-2 from-green-500 to-blue-600 rounded-lg flex items-start justify-start">
        <mat-icon class="text-white">table_chart</mat-icon>
      </div>
      <div>
        <h1 class="text-2xl !m-0  font-bold text-gray-900">Google Sheets</h1>
        <p class="text-gray-600 text-sm">Import your financial data from Google Sheets </p>
      </div>
    </div>
  </div>

  <!-- Setup Instructions Card -->
  <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-8">
    <div class="flex items-center gap-3 mb-4">
      <mat-icon class="text-blue-600">info</mat-icon>
      <h3 class="text-lg font-semibold text-blue-900">Setup Instructions</h3>
    </div>
    
    <!-- Example Sheet Info -->
    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
      <div class="flex items-center gap-2 mb-2">
        <mat-icon class="text-green-600">lightbulb</mat-icon>
        <span class="font-medium text-green-800">Quick Start</span>
      </div>
      <p class="text-sm text-green-700 mb-3">
        Not sure how to format your Google Sheet? Click "Get Example Sheet" below to open a template you can copy and use as a starting point.
      </p>
    </div>
    
    <div class="space-y-2 text-sm text-blue-800">
      <ol class="list-decimal list-inside space-y-1">
        <li *ngFor="let instruction of getSetupInstructions()">{{ instruction }}</li>
      </ol>
    </div>
    <div class="mt-4 flex gap-3">
      <button mat-stroked-button color="primary" (click)="openApiDocs()" class="text-blue-600 border-blue-600">
        <mat-icon class="mr-2">open_in_new</mat-icon>
        View Google Sheets Help
      </button>
      <button mat-raised-button color="accent" (click)="openExampleSheet()" class="bg-green-600 text-white">
        <mat-icon class="mr-2">content_copy</mat-icon>
        Get Example Sheet
      </button>
    </div>
  </div>

  <!-- Connection Form -->
  <div class="bg-white border border-gray-200 rounded-xl p-6 mb-8 shadow-sm">
    <h3 class="text-xl font-semibold text-gray-900 mb-6">Add New Connection</h3>
    
    <form [formGroup]="connectionForm" (ngSubmit)="createConnection()" class="space-y-6">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Connection Name -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mb-2">Connection Name</label>
          <input
            id="name"
            type="text"
            formControlName="name"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            placeholder="My Google Sheets Connection"
          >
          <div *ngIf="getFieldError('name')" class="text-red-600 text-sm mt-1">{{ getFieldError('name') }}</div>
        </div>

        <!-- Sheet Name -->
        <div>
          <label for="sheetName" class="block text-sm font-medium text-gray-700 mb-2">Sheet Name</label>
          <input
            id="sheetName"
            type="text"
            formControlName="sheetName"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
            placeholder="Sheet1"
          >
          <div *ngIf="getFieldError('sheetName')" class="text-red-600 text-sm mt-1">{{ getFieldError('sheetName') }}</div>
        </div>
      </div>

      <!-- Sheet URL -->
      <div>
        <label for="spreadsheetUrl" class="block text-sm font-medium text-gray-700 mb-2">Google Sheets URL</label>
        <input
          id="spreadsheetUrl"
          type="url"
          formControlName="spreadsheetUrl"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"
          placeholder="https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit"
        >
        <div *ngIf="getFieldError('spreadsheetUrl')" class="text-red-600 text-sm mt-1">{{ getFieldError('spreadsheetUrl') }}</div>
        <p class="text-gray-500 text-sm mt-1">Make sure your Google Sheet is shared with "Anyone with the link can view"</p>
      </div>

      <!-- Active Toggle -->
      <div class="flex items-center gap-3">
        <mat-slide-toggle formControlName="isActive" color="primary"></mat-slide-toggle>
        <label class="text-sm font-medium text-gray-700">Active Connection</label>
      </div>

      <!-- Action Buttons -->
      <div class="flex gap-4">
        <button
          type="button"
          mat-stroked-button
          color="primary"
          (click)="testConnection()"
          [disabled]="isTestingConnection || !connectionForm.valid"
          class="flex items-center gap-2"
        >
          <mat-spinner *ngIf="isTestingConnection" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!isTestingConnection">wifi_tethering</mat-icon>
          {{ isTestingConnection ? 'Testing...' : 'Test Connection' }}
        </button>
        
        <button
          type="submit"
          mat-raised-button
          color="primary"
          [disabled]="!connectionForm.valid"
          class="flex items-center gap-2"
        >
          <mat-icon>add</mat-icon>
          Create Connection
        </button>
      </div>
    </form>
  </div>

  <!-- Connections List -->
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm">
    <div class="p-6 border-b border-gray-200">
      <h3 class="text-xl font-semibold text-gray-900">Your Connections</h3>
    </div>

    <div class="p-6">
      <div *ngIf="isLoading" class="flex justify-center py-8">
        <mat-spinner diameter="40"></mat-spinner>
      </div>

      <div *ngIf="!isLoading && connections.length === 0" class="text-center py-12">
        <mat-icon class="text-gray-400 text-6xl mb-4">table_chart</mat-icon>
        <h4 class="text-lg font-medium text-gray-900 mb-2">No connections yet</h4>
        <p class="text-gray-600">Create your first Google Sheets connection to import data</p>
      </div>

      <div *ngIf="!isLoading && connections.length > 0" class="space-y-4">
        <div *ngFor="let connection of connections" class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center">
                <mat-icon class="text-white">table_chart</mat-icon>
              </div>
              <div>
                <h4 class="font-semibold text-gray-900">{{ connection.name }}</h4>
                <p class="text-sm text-gray-600">{{ connection.spreadsheetId }}</p>
              </div>
            </div>
            
            <div class="flex items-center gap-2">
              <mat-slide-toggle
                [checked]="connection.isActive"
                (change)="connection.isActive = $event.checked; updateConnection(connection)"
                color="primary"
              ></mat-slide-toggle>
              
              <button
                mat-icon-button
                color="warn"
                (click)="deleteConnection(connection)"
                matTooltip="Delete Connection"
              >
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
            <div>
              <span class="text-gray-600">Sheet:</span>
              <span class="font-medium ml-1">{{ connection.sheetName }}</span>
            </div>
            <div>
              <span class="text-gray-600">Status:</span>
              <span class="font-medium ml-1" [class]="connection.isActive ? 'text-green-600' : 'text-gray-500'">
                {{ connection.isActive ? 'Active' : 'Inactive' }}
              </span>
            </div>
            <div>
              <span class="text-gray-600">Last Sync:</span>
              <span class="font-medium ml-1">
                {{ connection.lastSync ? (connection.lastSync | date:'short') : 'Never' }}
              </span>
            </div>
          </div>

          <div class="flex gap-3 mt-4">
            <button
              mat-stroked-button
              color="primary"
              (click)="importFromSheet(connection)"
              [disabled]="isImporting"
              class="flex items-center gap-2"
            >
              <mat-spinner *ngIf="isImporting" diameter="16"></mat-spinner>
              <mat-icon *ngIf="!isImporting">download</mat-icon>
              {{ isImporting ? 'Importing...' : 'Import Data' }}
            </button>
            
            <a
              [href]="connection.spreadsheetUrl"
              target="_blank"
              mat-stroked-button
              color="accent"
              class="flex items-center gap-2"
            >
              <mat-icon>open_in_new</mat-icon>
              Open Sheet
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 