<div class="min-h-screen bg-gray-50 dark:bg-gray-900">
  <!-- Enhanced Header Section -->
 

  <!-- Enhanced Loading State -->
  <div *ngIf="isLoading" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <div class="text-center">
      <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 dark:bg-blue-900/20 rounded-full mb-6">
        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      </div>
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Loading Financial Data</h3>
      <p class="text-gray-600 dark:text-gray-400">Please wait while we prepare your reports...</p>
    </div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!isLoading" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-6">
    <!-- Key Metrics Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4">
      <!-- Total Income -->
      <div class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-xl p-4 sm:p-6 border border-green-200 dark:border-green-700 shadow-sm hover:shadow-md transition-shadow metric-card">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-green-600 dark:text-green-400 truncate">Total Income</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-green-900 dark:text-green-100 truncate">{{ formatCurrency(totalIncome) }}</p>
            <p class="text-xs text-green-600 dark:text-green-400 mt-1">This period</p>
          </div>
          <div class="bg-green-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-green-600 dark:text-green-400 text-lg sm:text-xl">trending_up</mat-icon>
          </div>
        </div>
      </div>

      <!-- Total Expenses -->
      <div class="bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 rounded-xl p-4 sm:p-6 border border-red-200 dark:border-red-700 shadow-sm hover:shadow-md transition-shadow metric-card">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-red-600 dark:text-red-400 truncate">Total Expenses</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-red-900 dark:text-red-100 truncate">{{ formatCurrency(totalExpenses) }}</p>
            <p class="text-xs text-red-600 dark:text-red-400 mt-1">This period</p>
          </div>
          <div class="bg-red-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-red-600 dark:text-red-400 text-lg sm:text-xl">trending_down</mat-icon>
          </div>
        </div>
      </div>

      <!-- Net Savings -->
      <div class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-xl p-4 sm:p-6 border border-blue-200 dark:border-blue-700 shadow-sm hover:shadow-md transition-shadow metric-card">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-blue-600 dark:text-blue-400 truncate">Net Savings</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-blue-900 dark:text-blue-100 truncate">{{ formatCurrency(netSavings) }}</p>
            <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">This period</p>
          </div>
          <div class="bg-blue-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-blue-600 dark:text-blue-400 text-lg sm:text-xl">account_balance_wallet</mat-icon>
          </div>
        </div>
      </div>

      <!-- Monthly Change -->
      <div class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-xl p-4 sm:p-6 border border-purple-200 dark:border-purple-700 shadow-sm hover:shadow-md transition-shadow metric-card">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-purple-600 dark:text-purple-400 truncate">Monthly Change</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-purple-900 dark:text-purple-100 truncate" [ngClass]="getMonthlyChangeColor()">
              {{ getMonthlyChangeDisplay() }}
            </p>
            <p class="text-xs text-purple-600 dark:text-purple-400 mt-1">vs last month</p>
          </div>
          <div class="bg-purple-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon [ngClass]="getMonthlyChangeColor()" class="text-lg sm:text-xl">{{ getMonthlyChangeIcon() }}</mat-icon>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Chart and Analytics Section -->
    <div class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
      <!-- Chart Header with Compact Controls -->
      <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
          <div class="flex-1 min-w-0">
            <h2 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">{{ getChartTitle() }}</h2>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Interactive financial visualization</p>
          </div>
          
          <!-- Compact Control Bar -->
          <div class="flex items-center space-x-2 compact-control-bar">
            <!-- Period Selector -->
            <mat-button-toggle-group 
              [value]="selectedPeriod" 
              (change)="onPeriodChange($event.value)"
              class="hidden sm:flex">
              <mat-button-toggle value="daily" class="text-xs">D</mat-button-toggle>
              <mat-button-toggle value="weekly" class="text-xs">W</mat-button-toggle>
              <mat-button-toggle value="monthly" class="text-xs">M</mat-button-toggle>
              <mat-button-toggle value="yearly" class="text-xs">Y</mat-button-toggle>
            </mat-button-toggle-group>

            <!-- Chart Type Menu -->
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="chartTypeMenu"
              matTooltip="Chart Type"
              class="text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400">
              <mat-icon>{{ selectedChartType === 'pie' ? 'pie_chart' : selectedChartType === 'bar' ? 'bar_chart' : selectedChartType === 'line' ? 'show_chart' : selectedChartType === 'area' ? 'area_chart' : selectedChartType === 'radar' ? 'radar' : selectedChartType === 'funnel' ? 'filter_alt' : selectedChartType === 'scatter' ? 'scatter_plot' : 'grid_on' }}</mat-icon>
            </button>
            <mat-menu #chartTypeMenu="matMenu" class="chart-type-menu">
              <div class="p-2">
                <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 px-3">Chart Type</div>
                <button 
                  mat-menu-item 
                  *ngFor="let type of availableChartTypes"
                  (click)="onChartTypeChange(type)"
                  [class.bg-blue-50]="selectedChartType === type"
                  class="flex items-center space-x-3">
                  <mat-icon class="text-sm">{{ type === 'pie' ? 'pie_chart' : type === 'bar' ? 'bar_chart' : type === 'line' ? 'show_chart' : type === 'area' ? 'area_chart' : type === 'radar' ? 'radar' : type === 'funnel' ? 'filter_alt' : type === 'scatter' ? 'scatter_plot' : 'grid_on' }}</mat-icon>
                  <span class="text-sm">{{ type.charAt(0).toUpperCase() + type.slice(1) }}</span>
                  <mat-icon *ngIf="selectedChartType === type" class="text-blue-600 text-sm">check</mat-icon>
                </button>
              </div>
            </mat-menu>

            <!-- Analytics View Menu -->
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="analyticsViewMenu"
              matTooltip="Analytics View"
              class="text-gray-600 dark:text-gray-400 hover:text-green-600 dark:hover:text-green-400">
              <mat-icon>analytics</mat-icon>
            </button>
            <mat-menu #analyticsViewMenu="matMenu" class="analytics-view-menu">
              <div class="p-2">
                <div class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 px-3">Analytics View</div>
                <button 
                  mat-menu-item 
                  *ngFor="let view of availableAnalyticsViews"
                  (click)="onAnalyticsViewChange(view)"
                  [class.bg-green-50]="selectedAnalyticsView === view"
                  class="flex items-center space-x-3">
                  <mat-icon class="text-sm">{{ view === 'overview' ? 'dashboard' : view === 'trends' ? 'trending_up' : view === 'categories' ? 'category' : view === 'accounts' ? 'account_balance' : view === 'comparison' ? 'compare' : 'timeline' }}</mat-icon>
                  <span class="text-sm">{{ view.charAt(0).toUpperCase() + view.slice(1) }}</span>
                  <mat-icon *ngIf="selectedAnalyticsView === view" class="text-green-600 text-sm">check</mat-icon>
                </button>
              </div>
            </mat-menu>

            <!-- Advanced Analytics Toggle -->
            <button 
              mat-icon-button 
              [matTooltip]="showAdvancedAnalytics ? 'Switch to Basic' : 'Switch to Advanced'"
              (click)="toggleAdvancedAnalytics()"
              [class.text-purple-600]="showAdvancedAnalytics"
              [class.text-gray-600]="!showAdvancedAnalytics"
              class="hover:text-purple-600 dark:hover:text-purple-400">
              <mat-icon>{{ showAdvancedAnalytics ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>

            <!-- More Options Menu -->
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="moreOptionsMenu"
              matTooltip="More Options"
              class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
              <mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #moreOptionsMenu="matMenu" class="more-options-menu">
              <button 
                mat-menu-item 
                (click)="openPreferencesDialog()"
                class="flex items-center space-x-3">
                <mat-icon class="text-sm">settings</mat-icon>
                <span class="text-sm">Preferences</span>
              </button>
              <button 
                mat-menu-item 
                (click)="refreshData()"
                [disabled]="isRefreshing"
                class="flex items-center space-x-3">
                <mat-icon class="text-sm" [class.animate-spin]="isRefreshing">refresh</mat-icon>
                <span class="text-sm">{{ isRefreshing ? 'Refreshing...' : 'Refresh Data' }}</span>
              </button>
              <button 
                mat-menu-item 
                (click)="toggleHelpTooltip()"
                class="flex items-center space-x-3">
                <mat-icon class="text-sm">help_outline</mat-icon>
                <span class="text-sm">Help</span>
              </button>
              <mat-divider></mat-divider>
              <button 
                mat-menu-item 
                (click)="toggleQuickFilters()"
                class="flex items-center space-x-3">
                <mat-icon class="text-sm">filter_list</mat-icon>
                <span class="text-sm">{{ showQuickFilters ? 'Hide' : 'Show' }} Filters</span>
              </button>
              <button 
                mat-menu-item 
                (click)="toggleExportOptions()"
                class="flex items-center space-x-3">
                <mat-icon class="text-sm">file_download</mat-icon>
                <span class="text-sm">{{ showExportOptions ? 'Hide' : 'Show' }} Export</span>
              </button>
            </mat-menu>
          </div>
        </div>
      </div>

      <!-- Chart Content -->
      <div class="p-4 sm:p-6">
        <div class="w-full chart-transition" [ngClass]="getChartHeight()">
          <div echarts [options]="getCurrentChartOption()" class="w-full h-full"></div>
        </div>
      </div>
    </div>

    <!-- Enhanced Analytics Summary Card -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Analytics Summary -->
      <div class="lg:col-span-2">
        <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden h-full">
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
              <div class="flex-1 min-w-0">
                <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Analytics Summary</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Key insights and trends</p>
              </div>
              <div class="bg-green-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
                <mat-icon class="text-green-600 dark:text-green-400">insights</mat-icon>
              </div>
            </div>
            
            <div class="space-y-4">
              <!-- Category Trends -->
              <div *ngIf="categoryTrends.length > 0" class="space-y-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center">
                  <mat-icon class="text-sm mr-2">category</mat-icon>
                  Category Trends
                </h4>
                <div *ngFor="let trend of categoryTrends.slice(0, 3)" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                  <span class="text-sm text-gray-600 dark:text-gray-400 truncate">{{ trend.category }}</span>
                  <span class="text-sm font-medium" [ngClass]="trend.change >= 0 ? 'text-red-600' : 'text-green-600'">
                    {{ trend.change >= 0 ? '+' : '' }}{{ trend.percentage.toFixed(1) }}%
                  </span>
                </div>
              </div>

              <!-- Spending Trends -->
              <div *ngIf="spendingTrends.length > 0" class="space-y-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center">
                  <mat-icon class="text-sm mr-2">trending_up</mat-icon>
                  Spending Trends
                </h4>
                <div *ngFor="let trend of spendingTrends.slice(0, 3)" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                  <span class="text-sm text-gray-600 dark:text-gray-400 truncate">{{ trend.period }}</span>
                  <span class="text-sm font-medium text-gray-900 dark:text-white">{{ formatCurrency(trend.amount) }}</span>
                </div>
              </div>

              <!-- Account Balances -->
              <div *ngIf="accountBalances.length > 0" class="space-y-3">
                <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 flex items-center">
                  <mat-icon class="text-sm mr-2">account_balance</mat-icon>
                  Account Balances
                </h4>
                <div *ngFor="let account of accountBalances.slice(0, 3)" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-600 transition-colors">
                  <span class="text-sm text-gray-600 dark:text-gray-400 truncate">{{ account.account }}</span>
                  <span class="text-sm font-medium text-gray-900 dark:text-white">{{ formatCurrency(account.balance) }}</span>
                </div>
              </div>
            </div>
          </div>
        </mat-card>
      </div>

      <!-- Quick Actions Sidebar -->
      <div class="lg:col-span-1">
        <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden h-full">
          <div class="p-4 sm:p-6">
            <div class="flex items-center justify-between mb-4 sm:mb-6">
              <div class="flex-1 min-w-0">
                <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Quick Actions</h3>
                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Common tasks</p>
              </div>
              <div class="bg-blue-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
                <mat-icon class="text-blue-600 dark:text-blue-400">bolt</mat-icon>
              </div>
            </div>
            
            <div class="space-y-3">
              <button 
                mat-stroked-button 
                class="w-full justify-start"
                (click)="addTransaction()">
                <mat-icon class="mr-3">add</mat-icon>
                Add Transaction
              </button>
              
              <button 
                mat-stroked-button 
                class="w-full justify-start"
                (click)="exportReport()">
                <mat-icon class="mr-3">file_download</mat-icon>
                Export Report
              </button>
              
              <button 
                mat-stroked-button 
                class="w-full justify-start"
                (click)="refreshData()"
                [disabled]="isRefreshing">
                <mat-icon class="mr-3" [class.animate-spin]="isRefreshing">refresh</mat-icon>
                {{ isRefreshing ? 'Refreshing...' : 'Refresh Data' }}
              </button>
              
              <button 
                mat-stroked-button 
                class="w-full justify-start"
                (click)="toggleQuickFilters()">
                <mat-icon class="mr-3">filter_list</mat-icon>
                {{ showQuickFilters ? 'Hide' : 'Show' }} Filters
              </button>
              
              <button 
                mat-stroked-button 
                class="w-full justify-start"
                (click)="openPreferencesDialog()">
                <mat-icon class="mr-3">settings</mat-icon>
                Preferences
              </button>
            </div>
          </div>
        </mat-card>
      </div>
    </div>

    <!-- Enhanced Quick Filters -->
    <div *ngIf="showQuickFilters" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 sm:p-6">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="bg-blue-500/10 p-2 rounded-lg">
            <mat-icon class="text-blue-600 dark:text-blue-400">filter_list</mat-icon>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Quick Filters</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Filter your financial data</p>
          </div>
        </div>
        <button 
          mat-icon-button 
          (click)="toggleQuickFilters()"
          class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
          <mat-icon>expand_less</mat-icon>
        </button>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Range</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select>
              <mat-option value="7">Last 7 days</mat-option>
              <mat-option value="30">Last 30 days</mat-option>
              <mat-option value="90">Last 3 months</mat-option>
              <mat-option value="365">Last year</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Category</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select>
              <mat-option value="all">All Categories</mat-option>
              <mat-option *ngFor="let category of categories" [value]="category.name">{{ category.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Account</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select>
              <mat-option value="all">All Accounts</mat-option>
              <mat-option *ngFor="let account of accounts" [value]="account.name">{{ account.name }}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Transaction Type</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select>
              <mat-option value="all">All Types</mat-option>
              <mat-option value="income">Income</mat-option>
              <mat-option value="expense">Expense</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          mat-stroked-button 
          (click)="toggleQuickFilters()">
          Cancel
        </button>
        <button 
          mat-raised-button 
          color="primary"
          (click)="applyFilters()">
          Apply Filters
        </button>
      </div>
    </div>

    <!-- Quick Filters Toggle -->
    <div *ngIf="!showQuickFilters" class="flex justify-center">
      <button 
        mat-stroked-button 
        (click)="toggleQuickFilters()"
        class="flex items-center space-x-2 px-6 py-3">
        <mat-icon>filter_list</mat-icon>
        <span>Show Filters</span>
      </button>
    </div>

    <!-- Enhanced Metrics Grid -->
    <div *ngIf="showAdvancedAnalytics" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <!-- Average Daily Spending -->
      <div class="bg-gradient-to-br from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 rounded-xl p-4 sm:p-6 border border-orange-200 dark:border-orange-700">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-orange-600 dark:text-orange-400 truncate">Avg Daily Spending</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-orange-900 dark:text-orange-100 truncate">{{ formatCurrency(averageDailySpending) }}</p>
          </div>
          <div class="bg-orange-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-orange-600 dark:text-orange-400 text-lg sm:text-xl">schedule</mat-icon>
          </div>
        </div>
      </div>

      <!-- Average Monthly Spending -->
      <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 dark:from-indigo-900/20 dark:to-indigo-800/20 rounded-xl p-4 sm:p-6 border border-indigo-200 dark:border-indigo-700">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-indigo-600 dark:text-indigo-400 truncate">Avg Monthly Spending</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-indigo-900 dark:text-indigo-100 truncate">{{ formatCurrency(averageMonthlySpending) }}</p>
          </div>
          <div class="bg-indigo-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-indigo-600 dark:text-indigo-400 text-lg sm:text-xl">calendar_month</mat-icon>
          </div>
        </div>
      </div>

      <!-- Savings Rate -->
      <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 dark:from-emerald-900/20 dark:to-emerald-800/20 rounded-xl p-4 sm:p-6 border border-emerald-200 dark:border-emerald-700">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-emerald-600 dark:text-emerald-400 truncate">Savings Rate</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-emerald-900 dark:text-emerald-100 truncate">{{ savingsRate.toFixed(1) }}%</p>
          </div>
          <div class="bg-emerald-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-emerald-600 dark:text-emerald-400 text-lg sm:text-xl">trending_up</mat-icon>
          </div>
        </div>
      </div>

      <!-- Growth Rate -->
      <div class="bg-gradient-to-br from-rose-50 to-rose-100 dark:from-rose-900/20 dark:to-rose-800/20 rounded-xl p-4 sm:p-6 border border-rose-200 dark:border-rose-700">
        <div class="flex items-center justify-between">
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-rose-600 dark:text-rose-400 truncate">Expense Growth</p>
            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-rose-900 dark:text-rose-100 truncate" [ngClass]="expenseGrowthRate >= 0 ? 'text-rose-600' : 'text-green-600'">
              {{ expenseGrowthRate >= 0 ? '+' : '' }}{{ expenseGrowthRate.toFixed(1) }}%
            </p>
          </div>
          <div class="bg-rose-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
            <mat-icon class="text-rose-600 dark:text-rose-400 text-lg sm:text-xl">analytics</mat-icon>
          </div>
        </div>
      </div>
    </div>



    <!-- Reports Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-8">
      <!-- Spending Overview Card -->
      <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
        <div class="p-4 sm:p-6">
          <div class="flex items-center justify-between mb-4 sm:mb-6">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Spending Overview</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Your financial summary</p>
            </div>
            <div class="bg-blue-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
              <mat-icon class="text-blue-600 dark:text-blue-400">pie_chart</mat-icon>
            </div>
          </div>
          <div class="space-y-3 sm:space-y-4">
            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center space-x-3 min-w-0 flex-1">
                <div class="w-3 h-3 bg-green-500 rounded-full flex-shrink-0"></div>
                <span class="text-gray-700 dark:text-gray-300 truncate">Total Income</span>
              </div>
              <span class="font-semibold text-green-600 dark:text-green-400 ml-3 text-right">{{ formatCurrency(totalIncome) }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center space-x-3 min-w-0 flex-1">
                <div class="w-3 h-3 bg-red-500 rounded-full flex-shrink-0"></div>
                <span class="text-gray-700 dark:text-gray-300 truncate">Total Expenses</span>
              </div>
              <span class="font-semibold text-red-600 dark:text-red-400 ml-3 text-right">{{ formatCurrency(totalExpenses) }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center space-x-3 min-w-0 flex-1">
                <div class="w-3 h-3 bg-blue-500 rounded-full flex-shrink-0"></div>
                <span class="text-gray-700 dark:text-gray-300 truncate">Net Savings</span>
              </div>
              <span class="font-semibold text-blue-600 dark:text-blue-400 ml-3 text-right">{{ formatCurrency(netSavings) }}</span>
            </div>
          </div>
        </div>
      </mat-card>

      <!-- Monthly Trends Card -->
      <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
        <div class="p-4 sm:p-6">
          <div class="flex items-center justify-between mb-4 sm:mb-6">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Monthly Trends</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Compare monthly performance</p>
            </div>
            <div class="bg-green-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
              <mat-icon class="text-green-600 dark:text-green-400">trending_up</mat-icon>
            </div>
          </div>
          <div class="space-y-3 sm:space-y-4">
            <div *ngFor="let month of monthlyTrends.slice(-2)" class="flex justify-between items-center p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <span class="text-gray-700 dark:text-gray-300 truncate">{{ month.month }}</span>
              <span class="font-semibold text-gray-900 dark:text-white ml-3 text-right">{{ formatCurrency(month.savings) }}</span>
            </div>
            <div class="flex justify-between items-center p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-700">
              <span class="text-gray-700 dark:text-gray-300">Change</span>
              <span class="font-semibold text-green-600 dark:text-green-400 ml-3 text-right">{{ getMonthlyChangeDisplay() }}</span>
            </div>
          </div>
        </div>
      </mat-card>

      <!-- Top Categories Card -->
      <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
        <div class="p-4 sm:p-6">
          <div class="flex items-center justify-between mb-4 sm:mb-6">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Top Spending Categories</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Your highest expense areas</p>
            </div>
            <div class="bg-purple-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
              <mat-icon class="text-purple-600 dark:text-purple-400">category</mat-icon>
            </div>
          </div>
          
          <!-- Categories List -->
          <div *ngIf="topCategories.length > 0" class="space-y-3">
            <div *ngFor="let category of topCategories" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center space-x-3 min-w-0 flex-1">
                <div class="w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-gray-100 dark:bg-gray-600">
                  <mat-icon class="text-sm" [style.color]="category.color">{{ category.icon }}</mat-icon>
                </div>
                <div class="min-w-0 flex-1">
                  <span class="text-gray-700 dark:text-gray-300 font-medium truncate block">{{ category.category }}</span>
                  <div class="text-xs text-gray-500 dark:text-gray-400">{{ category.percentage.toFixed(1) }}% of total</div>
                </div>
              </div>
              <span class="font-semibold text-gray-900 dark:text-white ml-3 text-right">{{ formatCurrency(category.amount) }}</span>
            </div>
          </div>

          <!-- No Data State -->
          <div *ngIf="topCategories.length === 0" class="text-center py-8 sm:py-12">
            <div class="bg-gray-100 dark:bg-gray-700 w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4">
              <mat-icon class="text-gray-400 text-2xl sm:text-3xl">bar_chart</mat-icon>
            </div>
            <h4 class="text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2">No Data Available</h4>
            <p class="text-sm text-gray-500 dark:text-gray-400">Add transactions to see category breakdown</p>
          </div>
        </div>
      </mat-card>

      <!-- Recent Activity Card -->
      <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
        <div class="p-4 sm:p-6">
          <div class="flex items-center justify-between mb-4 sm:mb-6">
            <div class="flex-1 min-w-0">
              <h3 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white truncate">Recent Activity</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Latest transactions</p>
            </div>
            <div class="bg-orange-500/10 p-2 sm:p-3 rounded-lg flex-shrink-0 ml-3">
              <mat-icon class="text-orange-600 dark:text-orange-400">schedule</mat-icon>
            </div>
          </div>
          
          <!-- Recent Transactions List -->
          <div *ngIf="recentTransactions.length > 0" class="space-y-3">
            <div *ngFor="let transaction of recentTransactions" class="flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg">
              <div class="flex items-center space-x-3 min-w-0 flex-1">
                <mat-icon [ngClass]="getTransactionColor(transaction)" class="flex-shrink-0">{{ getTransactionIcon(transaction) }}</mat-icon>
                <div class="min-w-0 flex-1">
                  <span class="text-gray-700 dark:text-gray-300 font-medium truncate block">{{ transaction.payee }}</span>
                  <div class="text-xs text-gray-500 dark:text-gray-400 truncate">{{ transaction.category }}</div>
                </div>
              </div>
              <div class="text-right ml-3 flex-shrink-0">
                <span class="font-semibold block" [ngClass]="getTransactionColor(transaction)">
                  {{ transaction.type === 'income' ? '+' : '-' }}{{ formatCurrency(transaction.amount) }}
                </span>
                <div class="text-xs text-gray-500 dark:text-gray-400">
                  {{ dateService.toDate(transaction.date) | date:'MMM dd' }}
                </div>
              </div>
            </div>
          </div>

          <!-- No Data State -->
          <div *ngIf="recentTransactions.length === 0" class="text-center py-8 sm:py-12">
            <div class="bg-gray-100 dark:bg-gray-700 w-16 h-16 sm:w-20 sm:h-20 rounded-full flex items-center justify-center mx-auto mb-4">
              <mat-icon class="text-gray-400 text-2xl sm:text-3xl">receipt_long</mat-icon>
            </div>
            <h4 class="text-base sm:text-lg font-medium text-gray-900 dark:text-white mb-2">No Recent Transactions</h4>
            <p class="text-sm text-gray-500 dark:text-gray-400">Your recent activity will appear here</p>
          </div>
        </div>
      </mat-card>
    </div>

    <!-- Enhanced Export Options -->
    <div *ngIf="showExportOptions" class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 sm:p-6">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="bg-green-500/10 p-2 rounded-lg">
            <mat-icon class="text-green-600 dark:text-green-400">file_download</mat-icon>
          </div>
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Export Options</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">Export your financial reports</p>
          </div>
        </div>
        <button 
          mat-icon-button 
          (click)="toggleExportOptions()"
          class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200">
          <mat-icon>expand_less</mat-icon>
        </button>
      </div>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select [(ngModel)]="userPreferences.exportFormat">
              <mat-option value="pdf">PDF Report</mat-option>
              <mat-option value="excel">Excel Spreadsheet</mat-option>
              <mat-option value="csv">CSV Data</mat-option>
              <mat-option value="json">JSON Data</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Range</label>
          <mat-form-field appearance="fill" class="w-full">
            <mat-select>
              <mat-option value="current">Current Month</mat-option>
              <mat-option value="last3">Last 3 Months</mat-option>
              <mat-option value="last6">Last 6 Months</mat-option>
              <mat-option value="last12">Last 12 Months</mat-option>
              <mat-option value="custom">Custom Range</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Include Charts</label>
          <mat-slide-toggle class="w-full">Include Visualizations</mat-slide-toggle>
        </div>
        <div class="flex items-end">
          <button 
            mat-raised-button 
            color="primary"
            class="w-full"
            (click)="exportReport()">
            <mat-icon class="mr-2">download</mat-icon>
            Export Report
          </button>
        </div>
      </div>
      <div class="flex justify-end space-x-3 mt-6">
        <button 
          mat-stroked-button 
          (click)="toggleExportOptions()">
          Cancel
        </button>
        <button 
          mat-raised-button 
          color="accent"
          (click)="generateReport()">
          <mat-icon class="mr-2">description</mat-icon>
          Generate Report
        </button>
      </div>
    </div>

    <!-- Export Options Toggle -->
    <div *ngIf="!showExportOptions" class="flex justify-center">
      <button 
        mat-stroked-button 
        (click)="toggleExportOptions()"
        class="flex items-center space-x-2 px-6 py-3">
        <mat-icon>file_download</mat-icon>
        <span>Export Options</span>
      </button>
    </div>

    <!-- Detailed Reports Section -->
    <mat-card class="bg-white dark:bg-gray-800 shadow-lg border-0 rounded-xl overflow-hidden">
      <div class="p-4 sm:p-6">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-6 sm:mb-8">
          <div class="flex-1 min-w-0">
            <h3 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white">Detailed Analysis</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">Deep dive into your financial data</p>
          </div>
          <div class="flex flex-wrap gap-2 justify-center lg:justify-end">
            <button 
              mat-stroked-button 
              class="px-3 sm:px-4 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              [class.bg-blue-50]="selectedPeriod === 'daily'"
              (click)="onPeriodChange('daily')">
              Daily
            </button>
            <button 
              mat-stroked-button 
              class="px-3 sm:px-4 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              [class.bg-blue-50]="selectedPeriod === 'weekly'"
              (click)="onPeriodChange('weekly')">
              Weekly
            </button>
            <button 
              mat-raised-button 
              color="primary" 
              class="px-3 sm:px-4 py-2 text-xs sm:text-sm rounded-lg shadow-md hover:shadow-lg transition-shadow"
              [class.bg-blue-600]="selectedPeriod === 'monthly'"
              (click)="onPeriodChange('monthly')">
              Monthly
            </button>
            <button 
              mat-stroked-button 
              class="px-3 sm:px-4 py-2 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
              [class.bg-blue-50]="selectedPeriod === 'yearly'"
              (click)="onPeriodChange('yearly')">
              Yearly
            </button>
          </div>
        </div>
        
        <!-- Data Available State -->
        <div *ngIf="hasData" class="space-y-6">
          <!-- Monthly Trends Chart -->
          <div class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 sm:p-6">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Monthly Trends</h4>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-3 sm:gap-4">
              <div *ngFor="let month of monthlyTrends" class="text-center p-3 bg-white dark:bg-gray-600 rounded-lg">
                <div class="text-xs sm:text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 truncate">{{ month.month }}</div>
                <div class="text-sm sm:text-lg font-bold text-green-600 dark:text-green-400 truncate">{{ formatCurrency(month.income) }}</div>
                <div class="text-xs sm:text-sm text-red-600 dark:text-red-400 truncate">{{ formatCurrency(month.expenses) }}</div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1 truncate">
                  {{ month.savings >= 0 ? '+' : '' }}{{ formatCurrency(month.savings) }}
                </div>
              </div>
            </div>
          </div>

          <!-- Category Breakdown -->
          <div *ngIf="topCategories.length > 0" class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 sm:p-6">
            <h4 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Category Breakdown</h4>
            <div class="space-y-3">
              <div *ngFor="let category of topCategories" class="flex items-center justify-between">
                <div class="flex items-center space-x-3 min-w-0 flex-1">
                  <div class="w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 bg-gray-100 dark:bg-gray-600">
                    <mat-icon class="text-xs" [style.color]="category.color">{{ category.icon }}</mat-icon>
                  </div>
                  <span class="text-gray-700 dark:text-gray-300 truncate">{{ category.category }}</span>
                </div>
                <div class="flex items-center space-x-3 sm:space-x-4 ml-3">
                  <div class="w-20 sm:w-32 bg-gray-200 dark:bg-gray-600 rounded-full h-2 flex-shrink-0">
                    <div class="bg-blue-600 h-2 rounded-full" [style.width.%]="category.percentage"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-900 dark:text-white w-16 sm:w-20 text-right truncate">
                    {{ formatCurrency(category.amount) }}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- No Data State -->
        <div *ngIf="!hasData" class="text-center py-12 sm:py-16">
          <div class="bg-gray-100 dark:bg-gray-700 w-20 h-20 sm:w-24 sm:h-24 rounded-full flex items-center justify-center mx-auto mb-6">
            <mat-icon class="text-gray-400 text-4xl sm:text-5xl">analytics</mat-icon>
          </div>
          <h4 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-3">No Data Available</h4>
          <p class="text-sm sm:text-base text-gray-600 dark:text-gray-400 mb-6 max-w-md mx-auto">
            Start adding transactions to see detailed reports and insights about your financial patterns.
          </p>
          <button 
            mat-raised-button 
            color="primary" 
            class="flex items-center space-x-2 px-4 sm:px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-shadow mx-auto"
            (click)="addTransaction()">
            <mat-icon>add</mat-icon>
            <span>Add Transaction</span>
          </button>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Preferences Dialog -->
  <div *ngIf="showPreferencesDialog" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white">Analytics Preferences</h2>
          <button 
            mat-icon-button 
            (click)="closePreferencesDialog()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-2">Customize your analytics dashboard experience</p>
      </div>

      <div class="p-6 space-y-6">
        <!-- Default Settings -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Default Settings</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Chart Type</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.defaultChartType">
                    <mat-option *ngFor="let type of availableChartTypes" [value]="type">
                      {{ type.charAt(0).toUpperCase() + type.slice(1) }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Analytics View</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.defaultAnalyticsView">
                    <mat-option *ngFor="let view of availableAnalyticsViews" [value]="view">
                      {{ view.charAt(0).toUpperCase() + view.slice(1) }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Default Period</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.defaultPeriod">
                    <mat-option value="daily">Daily</mat-option>
                    <mat-option value="weekly">Weekly</mat-option>
                    <mat-option value="monthly">Monthly</mat-option>
                    <mat-option value="yearly">Yearly</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>

          <div>
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Display Options</h3>
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Chart Height</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.chartHeight">
                    <mat-option value="small">Small</mat-option>
                    <mat-option value="medium">Medium</mat-option>
                    <mat-option value="large">Large</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Currency Format</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.currencyFormat">
                    <mat-option value="INR">Indian Rupee (₹)</mat-option>
                    <mat-option value="USD">US Dollar ($)</mat-option>
                    <mat-option value="EUR">Euro (€)</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Date Format</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.dateFormat">
                    <mat-option value="DD/MM/YYYY">DD/MM/YYYY</mat-option>
                    <mat-option value="MM/DD/YYYY">MM/DD/YYYY</mat-option>
                    <mat-option value="YYYY-MM-DD">YYYY-MM-DD</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>

        <!-- Chart Options -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Chart Options</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
              <mat-slide-toggle 
                [(ngModel)]="userPreferences.showTooltips"
                class="w-full">
                Show Tooltips
              </mat-slide-toggle>

              <mat-slide-toggle 
                [(ngModel)]="userPreferences.showAnimations"
                class="w-full">
                Show Animations
              </mat-slide-toggle>

              <mat-slide-toggle 
                [(ngModel)]="userPreferences.showAdvancedAnalytics"
                class="w-full">
                Show Advanced Analytics
              </mat-slide-toggle>
            </div>

            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Refresh Interval (minutes)</label>
                <mat-form-field appearance="fill" class="w-full">
                  <input matInput type="number" [(ngModel)]="userPreferences.refreshInterval" min="1" max="60">
                </mat-form-field>
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Export Format</label>
                <mat-form-field appearance="fill" class="w-full">
                  <mat-select [(ngModel)]="userPreferences.exportFormat">
                    <mat-option value="pdf">PDF</mat-option>
                    <mat-option value="excel">Excel</mat-option>
                    <mat-option value="csv">CSV</mat-option>
                    <mat-option value="json">JSON</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>

        <!-- Email Reports -->
        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Email Reports</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <mat-slide-toggle 
              [(ngModel)]="userPreferences.emailReports"
              class="w-full">
              Enable Email Reports
            </mat-slide-toggle>

            <div *ngIf="userPreferences.emailReports">
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Email Frequency</label>
              <mat-form-field appearance="fill" class="w-full">
                <mat-select [(ngModel)]="userPreferences.emailFrequency">
                  <mat-option value="daily">Daily</mat-option>
                  <mat-option value="weekly">Weekly</mat-option>
                  <mat-option value="monthly">Monthly</mat-option>
                  <mat-option value="never">Never</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
        </div>
      </div>

      <div class="p-6 border-t border-gray-200 dark:border-gray-700 flex justify-between">
        <button 
          mat-stroked-button 
          (click)="resetPreferences()"
          class="text-red-600 border-red-600 hover:bg-red-50">
          Reset to Default
        </button>
        <div class="space-x-3">
          <button 
            mat-stroked-button 
            (click)="closePreferencesDialog()">
            Cancel
          </button>
          <button 
            mat-raised-button 
            color="primary"
            (click)="savePreferences(); closePreferencesDialog()">
            Save Preferences
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Tooltip -->
  <div *ngIf="showHelpTooltip" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-2xl w-full">
      <div class="p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-bold text-gray-900 dark:text-white">Analytics Help</h2>
          <button 
            mat-icon-button 
            (click)="toggleHelpTooltip()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <div class="p-6 space-y-4">
        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Chart Types</h3>
          <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
            <p><strong>Pie Chart:</strong> Shows spending breakdown by category</p>
            <p><strong>Bar Chart:</strong> Displays monthly financial trends</p>
            <p><strong>Line Chart:</strong> Shows trends over time with smooth curves</p>
            <p><strong>Area Chart:</strong> Displays daily spending patterns</p>
            <p><strong>Radar Chart:</strong> Compares category performance</p>
            <p><strong>Funnel Chart:</strong> Shows spending funnel analysis</p>
            <p><strong>Scatter Chart:</strong> Shows income vs expenses correlation</p>
            <p><strong>Heatmap:</strong> Displays weekly spending patterns</p>
          </div>
        </div>

        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Analytics Views</h3>
          <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
            <p><strong>Overview:</strong> General financial summary</p>
            <p><strong>Trends:</strong> Historical data analysis</p>
            <p><strong>Categories:</strong> Category-wise breakdown</p>
            <p><strong>Accounts:</strong> Account-specific data</p>
            <p><strong>Comparison:</strong> Period-over-period analysis</p>
            <p><strong>Forecast:</strong> Future predictions</p>
          </div>
        </div>

        <div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Tips</h3>
          <div class="space-y-2 text-sm text-gray-600 dark:text-gray-400">
            <p>• Use different chart types to view data from various perspectives</p>
            <p>• Switch between time periods to analyze trends</p>
            <p>• Enable advanced analytics for detailed insights</p>
            <p>• Customize preferences to match your workflow</p>
            <p>• Export reports for sharing or offline analysis</p>
          </div>
        </div>
      </div>

      <div class="p-6 border-t border-gray-200 dark:border-gray-700">
        <button 
          mat-raised-button 
          color="primary"
          (click)="toggleHelpTooltip()"
          class="w-full">
          Got it!
        </button>
      </div>
    </div>
  </div>

  <!-- Floating Action Button -->
  <div class="fixed bottom-6 right-6 z-40">
    <div class="flex flex-col space-y-2">
      <!-- Quick Actions FAB -->
      <button 
        mat-fab 
        color="primary"
        class="shadow-lg"
        matTooltip="Quick Actions"
        (click)="toggleQuickActions()">
        <mat-icon>{{ showQuickActions ? 'close' : 'add' }}</mat-icon>
      </button>
      
      <!-- Quick Actions Menu -->
      <div *ngIf="showQuickActions" class="flex flex-col space-y-2">
        <button 
          mat-mini-fab 
          color="accent"
          class="shadow-lg"
          matTooltip="Add Transaction"
          (click)="addTransaction()">
          <mat-icon>receipt</mat-icon>
        </button>
        
        <button 
          mat-mini-fab 
          color="warn"
          class="shadow-lg"
          matTooltip="Export Report"
          (click)="exportReport()">
          <mat-icon>file_download</mat-icon>
        </button>
        
        <button 
          mat-mini-fab 
          color="primary"
          class="shadow-lg"
          matTooltip="Refresh Data"
          (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div> 