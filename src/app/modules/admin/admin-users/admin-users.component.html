<div class="admin-users-container">
  <!-- Header -->
  <div class="section-header">
    <div class="header-content">
      <h2>User Management</h2>
      <p>Manage user accounts and permissions</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="accent" (click)="exportUsers()" [disabled]="filteredUsers.length === 0">
        <mat-icon>download</mat-icon>
        Export CSV
      </button>
      <button mat-raised-button color="warn" (click)="clearFilters()">
        <mat-icon>clear</mat-icon>
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Filters and Search -->
  <div class="filters-section">
    <div class="search-bar">
      <mat-form-field appearance="fill" class="search-field">
        <mat-label>Search users</mat-label>
        <input matInput [formControl]="searchControl" placeholder="Search by name or email">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <div class="filter-controls">
      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Status</mat-label>
        <mat-select [formControl]="statusFilter">
          <mat-option *ngFor="let option of statusOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="fill" class="filter-field">
        <mat-label>Role</mat-label>
        <mat-select [formControl]="roleFilter">
          <mat-option *ngFor="let option of roleOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>

  <!-- Results Summary -->
  <div class="results-summary">
    <div class="summary-info">
      <span class="total-count">Showing {{ filteredUsers.length }} of {{ usersList.length }} users</span>
      <span class="page-info" *ngIf="totalItems > 0">
        Page {{ currentPage }} of {{ getTotalPages() }}
      </span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading users...</p>
  </div>

  <!-- Users List -->
  <div *ngIf="!isLoading && getPaginatedUsers().length > 0" class="users-list">
    <div *ngFor="let user of getPaginatedUsers()" class="user-item">
      <div class="user-header">
        <div class="user-meta">
          <div class="user-info">
            <div class="avatar">
              <img *ngIf="user.photoURL" [src]="user.photoURL" [alt]="user.displayName || user.email">
              <mat-icon *ngIf="!user.photoURL">person</mat-icon>
            </div>
            <div class="user-details">
              <h4>{{ user.displayName || 'No Name' }}</h4>
              <p>{{ user.email }}</p>
              <div class="user-stats">
                <span class="stat">
                  <mat-icon>receipt_long</mat-icon>
                  {{ user.totalTransactions || 0 }} transactions
                </span>
                <span class="stat">
                  <mat-icon>category</mat-icon>
                  {{ user.totalCategories || 0 }} categories
                </span>
              </div>
            </div>
          </div>
          <div class="user-badges">
            <span class="badge status" [style.background-color]="getStatusColor(user.status)">
              <mat-icon>{{ getStatusIcon(user.status) }}</mat-icon>
              {{ user.status | titlecase }}
            </span>
            <span class="badge role" [class.admin]="user.isAdmin">
              <mat-icon>{{ user.isAdmin ? 'admin_panel_settings' : 'person' }}</mat-icon>
              {{ user.isAdmin ? 'Admin' : 'User' }}
            </span>
            <span class="badge verified" *ngIf="user.emailVerified">
              <mat-icon>verified</mat-icon>
              Verified
            </span>
          </div>
        </div>
        <div class="user-actions">
          <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="Actions">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="updateUserStatus(user, 'active')" *ngIf="user.status !== 'active'">
              <mat-icon>check_circle</mat-icon>
              Activate User
            </button>
            <button mat-menu-item (click)="updateUserStatus(user, 'suspended')" *ngIf="user.status !== 'suspended'">
              <mat-icon>block</mat-icon>
              Suspend User
            </button>
            <button mat-menu-item (click)="updateUserStatus(user, 'pending')" *ngIf="user.status !== 'pending'">
              <mat-icon>pending</mat-icon>
              Mark as Pending
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="toggleAdminRole(user)">
              <mat-icon>{{ user.isAdmin ? 'person' : 'admin_panel_settings' }}</mat-icon>
              {{ user.isAdmin ? 'Remove Admin' : 'Make Admin' }}
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="sendEmailToUser(user)">
              <mat-icon>email</mat-icon>
              Send Email
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item (click)="deleteUser(user)" class="delete-action">
              <mat-icon>delete</mat-icon>
              Delete User
            </button>
          </mat-menu>
        </div>
      </div>

      <div class="user-content">
        <div class="user-dates">
          <div class="date-info">
            <span class="label">Created:</span>
            <span class="value">{{ formatDate(user.createdAt) }}</span>
          </div>
          <div class="date-info" *ngIf="user.lastSignInAt">
            <span class="label">Last Sign In:</span>
            <span class="value">{{ formatDateTime(user.lastSignInAt) }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && getPaginatedUsers().length === 0" class="empty-state">
    <mat-icon>people</mat-icon>
    <h3>No users found</h3>
    <p *ngIf="filteredUsers.length === 0 && usersList.length > 0">
      No users match your current filters. Try adjusting your search criteria.
    </p>
    <p *ngIf="usersList.length === 0">
      No users have registered yet.
    </p>
    <button *ngIf="filteredUsers.length === 0 && usersList.length > 0" 
            mat-raised-button color="primary" 
            (click)="clearFilters()">
      Clear Filters
    </button>
  </div>

  <!-- Pagination -->
  <div *ngIf="getTotalPages() > 1" class="pagination-container">
    <mat-paginator
      [length]="totalItems"
      [pageSize]="itemsPerPage"
      [pageIndex]="currentPage - 1"
      [pageSizeOptions]="[5, 10, 25, 50]"
      (page)="onPageChange($event.pageIndex + 1)"
      showFirstLastButtons>
    </mat-paginator>
  </div>
</div> 